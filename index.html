---
layout: default
---

<div class="home">
	{% if page.title %}
	<h1 class="page-heading">{{ page.title }}</h1>
	{% endif %}

	<p>Hi! We’re VacFind! Our goal is to make COVID-19 vaccinations as easy and accessible as possible.</p>
	
	<p>Once we’re up and running, this site will let you search for your location anywhere in the US and tell you the locations of the nearest places in your area that have COVID vaccines available and whether or not you’re eligible.</p>
	
	<p>We’re moving as fast as we can, but the task isn’t easy. We’re still building a lot of important functionality. In the meantime, we recommend you check out the following resources and volunteer projects for more information on vaccination in each region.</p>

	<p>We are entirely volunteer-run and all our code is open source. If you want to help out or suggest a change or addition to our list, fill out <a href="{{site.newlinkform}}">this form</a>. You can also join us on <a href="{{site.social.discord}}">Discord</a> if you'd like to help out or come chat with the team!</p>

	<p>Official government-run sites are listed in <strong>bold</strong> text.</p>
	<select id="state-select"></select>
	<div id="state-link-list"></div>

	<div id="national-link-list"></div>
	

	<script src='/assets/js/covidjs.bundle.js'></script>
	<script>
		// import { us_land_groups, generateSelectionOptions } from '/assets/js/script.js';

		const vacFind = new covidjs.VacFindBackend()

		let stateListElement = document.getElementById("state-link-list");
		stateListElement.innerText = "Loading..."
		let nationalListElement = document.getElementById("national-link-list");
		nationalListElement.innerText = "Loading..."
		let stateSelectElement = document.getElementById("state-select");
		stateSelectElement.onchange = (event) => {
			const selectedState = event.target.value
			console.log("selected" + selectedState)
			populateStateList(selectedState)
		}
		
		stateSelectElement.appendChild(generateSelectionOptions([]))
		for (const child of generateSelectionOptions(us_land_groups)) {
			stateSelectElement.appendChild(child)
		}
		

		let groups = Object.assign({},
			{"USA": "National (United States)"},
			us_land_groups
		)

		let stored_records = vacFind.retrieveFromStorage()
		let by_group = {}
			
		let filter = {
				$not: {
					$or: [
						{ $textFind: ["dev resource", { $fieldName: 'category' }] },
						{ $textFind: ["useless", { $fieldName: 'category' }] },
						{ $textFind: ["INTL", { $fieldName: 'group' }] }
					]
				},
				public: true
			}
		
		let records = vacFind.loadLinks(filter);

		const processRecords = (records) => {
			for (let record of records) {
				processRecord(record)
			}
			populateNationalList()
		}

		const processRecord = (record) => {
			if (record.url === undefined) {
				record = new covidjs.VacFindRecord(record)
			}
			
			// console.log(record.fields)
			const url = record.url;
			//the value of the group this belongs to, default to the "Miscellaneous" group if blank
			let group = record.group;

			//if no group is set, skip processing this record and dont display it
			if (!group) {
				return
			}
			const title = record.linkTitle;
			const isofficial = record.isOfficialResource();

			let listitem = document.createElement("li");
			let link = document.createElement("a");
			link.innerText = title ? title : url;
			link.href = url;
			link.className = isofficial ?"verified":"";
			link.dataset.recordId = record.airtableID;
			listitem.appendChild(link);

			if (!by_group[group]) {
				by_group[group] = []
			}

			by_group[group].push(listitem)
		}

		const populateStateList = (stateKey) => {
			stateListElement.innerText = ""

			if (stateKey) {

				createGroup(stateListElement, groups[stateKey], stateKey, by_group[stateKey])
			}
		};

		const populateNationalList = () => {
			nationalListElement.innerText = ""

			createGroup(nationalListElement, "National (United States)", "USA", by_group["USA"])
		};

		const createGroup = (parent, heading, id, links) => {

			if (heading) {
				let listheading = document.createElement("h3");
				listheading.innerText = heading;
				parent.appendChild(listheading);
			}
			let list = document.createElement("ul");
			list.id = id
			for (let link of links) {
				list.appendChild(createLink(link))
			}

			if (links.length == 0) {
				const notfound = document.createElement("p")
				notfound.innerHTML = `
				Whoops, it seems as though we do not have any entries for your selected region. Please reach out to us via <a href="mailto:{{site.contact.email}}">email</a>, or come talk to us on <a href="{{site.social.discord}}">Discord</a> and we will help you find resources in your area. If you would like to submit a link that you think should be here,  feel free to use our <a href="{{site.newlinkform}}">suggestions form</a>.
				`
				parent.appendChild(notfound);
			} else {
				parent.appendChild(list);
			}
		}

		const createLink = (url) => {
			return url
		}


		//populate the page if theres a value from local storage
		if (stored_records) {
			processRecords(stored_records)
		}

		records.then((results) => {
			by_group = {} //clear out anything that may be present from localstorage
			processRecords(results)
		});
		
	</script>
</div>