---
layout: default
---

<div class="home">

	<h1 class="page-heading">VacFind - A COVID-19 vaccine resource finder</h1>

	<p>Our goal is to make COVID-19 vaccinations as easy and accessible as possible. Thats why we have created a national directory of resources to help you find a COVID vaccine.</p>
	
	<p>Links to official information provided by government entities is listed in <b>bold</b> text. all other links are provided by volunteer groups or other non-government organisations.</p>

	<p>You can use the list below to find resources such as:
		<ul>
			<li>tools to automatically find open appointment slots near you</li>
			<li>local vaccine hunting and assistance groups</li>
			<li>links to updated information about vaccination programs in your state</li>
			<li>... and more!</li>
		</ul> 
	</p>

	<p>If you want to help out or suggest a change or addition to our list, please fill out <a href="{{site.data.link-corrections}}">this form</a> or come chat with our team on <a href="{{site.social.discord}}">Discord</a>!</p>

	<p><strong>Looking for international COVID-19 resources?</strong><br>
	VacFind is currently only providing links to US-based resources, however, the moderators of the r/Coronavirus subreddit have published a list of <a href="https://www.reddit.com/r/Coronavirus/wiki/faq/vaccinefinder">international resources for finding COVID vaccines</a>.</p>

	<select id="state-select"></select>
	<div id="state-link-list"></div>

	<h2>Looking for national resources? Try some of these:</h2>

	<div id="national-link-list"></div>
	<noscript>
		{% include noscript-backup.html %}
	</noscript>

	<script src='/assets/js/covidjs.bundle.js'></script>
	<script>
		// import { us_land_groups, generateSelectionOptions } from '/assets/js/script.js';

		const vacFind = new covidjs.VacFindBackend()

		let stateListElement = document.getElementById("state-link-list");
		let nationalListElement = document.getElementById("national-link-list");
		nationalListElement.innerText = "Loading..."
		let stateSelectElement = document.getElementById("state-select");
		stateSelectElement.onchange = (event) => {
			const selectedState = event.target.value
			console.log("selected" + selectedState)
			populateStateList(selectedState)
		}
		
		stateSelectElement.appendChild(generateSelectionOptions([]))
		for (const child of generateSelectionOptions(us_land_groups)) {
			stateSelectElement.appendChild(child)
		}
		

		let groups = Object.assign({},
			{"USA": "National (United States)"},
			us_land_groups
		)

		let by_group = {}
			
		let filter = {
				$not: {
					$or: [
						{ $textFind: ["dev resource", { $fieldName: 'category' }] },
						{ $textFind: ["useless", { $fieldName: 'category' }] },
						{ $textFind: ["INTL", { $fieldName: 'group' }] }
					]
				},
				public: true
			}
		
		let records = vacFind.loadLinks(filter);

		const processRecords = (records) => {
			for (let record of records) {
				processRecord(record)
			}
			populateNationalList()
		}

		const processRecord = (record) => {
			if (record.url === undefined) {
				record = new covidjs.VacFindRecord(record)
			}
			
			// console.log(record.fields)
			const url = record.url;
			//the value of the group this belongs to, default to the "Miscellaneous" group if blank
			let group = record.group;

			//if no group is set, skip processing this record and dont display it
			if (!group) {
				return
			}
			const title = record.linkTitle;
			const isofficial = record.isOfficialResource();

			let listitem = document.createElement("li");
			let link = document.createElement("a");
			link.innerText = title ? title : url;
			link.href = url;
			link.className = isofficial ?"verified":"";
			link.dataset.recordId = record.airtableID;
			listitem.appendChild(link);

			if (!by_group[group]) {
				by_group[group] = []
			}

			by_group[group].push(listitem)
		}

		const populateStateList = (stateKey) => {
			stateListElement.innerText = ""

			if (stateKey) {

				createGroup(stateListElement, null, stateKey, by_group[stateKey])
			}
		};

		const populateNationalList = () => {
			nationalListElement.innerText = ""

			createGroup(nationalListElement, null, "USA", by_group["USA"])
		};

		const createGroup = (parent, heading, id, links) => {

			if (heading) {
				let listheading = document.createElement("h3");
				listheading.innerText = heading;
				parent.appendChild(listheading);
			}
			let list = document.createElement("ul");
			list.id = id
			for (let link of links) {
				list.appendChild(createLink(link))
			}

			if (links.length == 0) {
				const notfound = document.createElement("p")
				notfound.innerHTML = `
				Whoops, it seems as though we do not have any entries for your selected region. Please reach out to us via <a href="mailto:{{site.contact.email}}">email</a>, or come talk to us on <a href="{{site.social.discord}}">Discord</a> and we will help you find resources in your area. If you would like to submit a link that you think should be here,  feel free to use our <a href="{{site.newlinkform}}">suggestions form</a>.
				`
				parent.appendChild(notfound);
			} else {
				parent.appendChild(list);
			}
		}

		const createLink = (url) => {
			return url
		}



		records.then((results) => {
			by_group = {} //clear out anything that may be present from localstorage
			processRecords(results)
		}).catch( (error) => {
			//if theres an error, use value from local storage
			console.error(error)
			let stored_records = vacFind.retrieveFromStorage()

			if (stored_records) {
				processRecords(stored_records)
			}
		});
		
	</script>
</div>
